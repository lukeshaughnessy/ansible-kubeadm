- name: Check if flannel is already installed
  shell: "kubectl get daemonset kube-flannel-ds --namespace=kube-system"
  register: result
  ignore_errors: yes
  changed_when: no

- name: Install flannel network plugin
  shell: 'curl -sSL "https://github.com/coreos/flannel/blob/master/Documentation/kube-flannel.yml?raw=true"
  | sed "s/amd64/{{ kubeadm_flannel_arch }}/g" | kubectl create -f -'
  when: result.rc != 0
